<style>
    html, body {
    margin: 0;
    padding: 0;
}
</style>
<canvas id="canvas"></canvas>


<script src="class/sendFetch.js"></script>
<script src="functions.js"></script>
<script>


// window.onload = function() {

//     var canvas = document.getElementById("canvas"),
//         ctx = canvas.getContext("2d"),
//         width = canvas.width = window.innerWidth,
//         height = canvas.height = window.innerHeight,
//         tileWidth = 60,
//         tileHeight = 30,
//         activeTile = null,

//         activeScale = {
//             status: false
//         };

//     const tiles = []
//     let mainMap = []
//     let img = document.createElement("img")

//     let getMap = async function (){

//         this.map = await new sendFetch(activeTile, 'getmap', 'GET')

//         return JSON.parse(this.map)
//     }

//     img.addEventListener("load", function() {

//         (async function(){

//             this.map = await getMap()

//             init(this.map);

//             setInterval(() => {

//                 ctx.clearRect(-width, -1000, 3000, 3000)
//                 draw()

//             },800)

//         })()

//     })
    
//     img.src = "tileset.png"

//     ctx.translate(width / 2, 10)


//     function init(map) {
//         for (var x = 0; x < map.length; x++) {
//             for (var y = 0; y < map[x].length; y++) {
//                 tiles.push({ x, y, index: map[x][y], active: false });
//             }
//         }
//         mainMap = map
//     }


//     function draw() {

//         tiles.forEach(t => drawImageTile(t) )
//     }


//     let rectFigure = new Path2D()
        
//         rectFigure.moveTo(2, 9)
//         rectFigure.lineTo(tileWidth / 2 + 2, tileHeight / 2 + 9)
//         rectFigure.lineTo(2, tileHeight + 9)
//         rectFigure.lineTo(-tileWidth / 2 + 2, tileHeight / 2 + 9)
//         rectFigure.lineTo(3, 9)



//     function drawImageTile({ x, y, index, active }) {


//         const xx = (x - y) * tileWidth / 2
//         const yy = (x + y) * tileHeight / 2

//         ctx.save();
//         ctx.translate(xx, yy)

        
//         ctx.drawImage(img, index * tileWidth, 0, tileWidth, img.height,
//         	-tileWidth / 2, 0, tileWidth, img.height);

//         if (active) ctx.strokeStyle = 'red'
//             else ctx.strokeStyle = '#ffffff00'

//         outlineRectSize(x, y, index, active, mainMap)





//         ctx.beginPath()
//         ctx.lineWidth = 3
//         ctx.stroke(rectFigure);
//         ctx.closePath()

//         ctx.restore();
//     }




//     canvas.addEventListener('mousemove', (e)=>{

//             let tile;
//             let isInPath = false;

//             for (tile of tiles) {

//                 isInPath = ctx.isPointInPath(
//                     rectFigure,
//                     e.clientX - (tile.x - tile.y) * tileWidth / 2,
//                     e.clientY - (tile.x + tile.y) * tileHeight / 2,

//                 )
                
//                 if (isInPath) break;
//             }
            
            
//             if (activeTile) activeTile.active = false;

//             if (isInPath) {

//                 activeTile = tile;
//                 activeTile.active = true;

//             }else{
//                 activeTile = null;

//             }

//             if(activeScale.status){

//                 ctx.setTransform(1, 0, 0, 1, e.clientX - activeScale.diffX, e.clientY - activeScale.diffY)

//             }
        

//     })

//     canvas.addEventListener('mousedown', function(e){

//         activeScale = {

//             status: true,
//             diffX: e.clientX - ctx.getTransform().e,
//             diffY: e.clientY - ctx.getTransform().f
//         }

//     })

//     canvas.addEventListener('mouseup', function(e){

//         activeScale.status = false

//     })

//     canvas.addEventListener('mouseout', function(e) {

//         if (activeTile) activeTile.active = false;

//         activeTile = null;
//         activeScale.status = false
//     })

//     canvas.addEventListener('click', function(e){

//        this.toFetch = async function (){

//            this.data = await new sendFetch(activeTile, 'currtile', 'POST')
    
//             console.log(this.data)
//         }
        
//         this.toFetch()

//     })
    

// }

</script>